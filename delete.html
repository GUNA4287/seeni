<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Employees</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    /* Cyber 3D Animated Background */
    body {
      margin: 0;
      padding: 20px;
      color: #fff;
      background: radial-gradient(ellipse at bottom, #0a0a0a 0%, #000 100%);
      overflow: hidden;
      font-family: 'Orbitron', sans-serif;
      position: relative;
      min-height: 100vh;
    }

    /* Moving Grid Animation */
    body::before {
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 200%;
      height: 200%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0,255,0,0.15) 0px,
        rgba(0,255,0,0.15) 1px,
        transparent 1px,
        transparent 40px
      ),
      repeating-linear-gradient(
        90deg,
        rgba(0,255,0,0.15) 0px,
        rgba(0,255,0,0.15) 1px,
        transparent 1px,
        transparent 40px
      );
      transform: translate(-25%, -25%) rotateX(60deg);
      animation: moveGrid 20s linear infinite;
      z-index: 0;
    }

    @keyframes moveGrid {
      from { transform: translate(-25%, -25%) rotateX(60deg) translateY(0); }
      to { transform: translate(-25%, -25%) rotateX(60deg) translateY(40px); }
    }

    .container {
      position: relative;
      z-index: 2;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,255,255,0.5);
    }

    h2 {
      color: #0ff;
      text-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
      display: inline-block;
    }

    /* Back Button */
    .back-btn {
      float: right;
      margin-top: -5px;
      background: #00ccff;
      border: none;
      color: #000;
      font-weight: bold;
      box-shadow: 0 0 10px #00ccff;
      transition: 0.3s;
    }

    .back-btn:hover {
      background: #33ddff;
      box-shadow: 0 0 20px #00ccff;
      color: #000;
    }

    /* Search box */
    .search-box {
      max-width: 300px;
      margin-bottom: 20px;
      border: 2px solid #0f0;
      background: rgba(0,255,0,0.1);
      color: #0f0;
    }

    /* Table */
    .table {
      color: #0f0;
      border: 1px solid #0f0;
    }

    .table thead {
      background: rgba(0,255,0,0.2);
      color: #0f0;
    }

    /* Images */
    img.emp-photo {
      width: 50px; height: 50px;
      object-fit: cover;
      border-radius: 50%;
      border: 2px solid #0ff;
    }

    /* Buttons */
    .btn-danger {
      background: #ff0044;
      border: none;
      box-shadow: 0 0 10px #ff0044;
      transition: 0.3s;
    }

    .btn-danger:hover {
      background: #ff3366;
      box-shadow: 0 0 20px #ff0044;
    }

    .btn-secondary {
      background: #555;
      border: none;
    }

    /* Modal */
    .modal-content {
      background: #111;
      color: #fff;
      border: 1px solid #0ff;
      box-shadow: 0 0 15px #0ff;
    }

  </style>
</head>
<body>
  <div class="container">
    <h2 class="mb-4">Employee Management</h2>
    <button class="btn back-btn" onclick="window.location.href='homepage.html'">Back to Home</button>

    <!-- Search Box -->
    <input type="text" id="searchInput" class="form-control search-box" placeholder="Search by Roll Number">

    <!-- Employee Table -->
    <table class="table table-bordered table-striped" id="employeeTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Photo</th>
          <th>Name</th>
          <th>Email</th>
          <th>Department</th>
          <th>Role</th>
          <th>Roll Number</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Deletion</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete <strong id="empName"></strong>?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = "http://127.0.0.1:8000/api/employees";
    let employees = [];
    let deleteId = null;

    // Load all employees
    async function loadEmployees() {
      const res = await fetch(API_BASE);
      const data = await res.json();
      if (data.ok) {
        employees = data.employees;
        renderTable(employees);
      }
    }

    // Render table rows
    function renderTable(list) {
      const tbody = document.querySelector("#employeeTable tbody");
      tbody.innerHTML = "";
      list.forEach(emp => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${emp.id}</td>
          <td>${emp.photo_url ? `<img src="${emp.photo_url}" class="emp-photo">` : ""}</td>
          <td>${emp.name}</td>
          <td>${emp.email}</td>
          <td>${emp.department}</td>
          <td>${emp.role}</td>
          <td>${emp.roll_number}</td>
          <td><button class="btn btn-danger btn-sm" onclick="showDeleteModal(${emp.id}, '${emp.name}')">Delete</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Filter employees by roll number
    document.getElementById("searchInput").addEventListener("input", e => {
      const val = e.target.value.toLowerCase();
      const filtered = employees.filter(emp => emp.roll_number.toLowerCase().includes(val));
      renderTable(filtered);
    });

    // Show delete modal
    function showDeleteModal(id, name) {
      deleteId = id;
      document.getElementById("empName").textContent = name;
      const modal = new bootstrap.Modal(document.getElementById("deleteModal"));
      modal.show();
    }

    // Confirm delete
    document.getElementById("confirmDeleteBtn").addEventListener("click", async () => {
      if (!deleteId) return;
      const res = await fetch(`${API_BASE}/${deleteId}`, { method: "DELETE" });
      const data = await res.json();
      if (data.ok) {
        employees = employees.filter(e => e.id !== deleteId);
        renderTable(employees);
        bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide();
      } else {
        alert(data.message || "Failed to delete");
      }
    });

    loadEmployees();
  </script>
</body>
</html>
