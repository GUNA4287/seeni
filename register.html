<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cyber Dept ‚Äî New Records</title>

<!-- Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --cyber1:#00fff0;
    --cyber2:#7c4dff;
    --ink:#02040a;
    --bg:#02060f;
  }
  html, body {
    height:100%;
    margin:0;
    background: radial-gradient(1200px 600px at 50% -10%, rgba(0,255,240,.18), transparent 60%),
                radial-gradient(800px 400px at 10% 120%, rgba(124,77,255,.12), transparent 60%), #000;
    color:#cfe9ff;
    font-family:"Orbitron", sans-serif;
    overflow-x:hidden;
  }
  /* 3D bg canvas */
  #bgCanvas{
    position:fixed; inset:0; width:100%; height:100%; z-index:-3;
  }

  header {
    position:relative;
    padding:16px 20px;
    display:flex; align-items:center; justify-content:center;
    background: linear-gradient(90deg, var(--cyber2), var(--cyber1));
    color:var(--ink); font-weight:700; font-size:1.3rem;
    border-bottom:2px solid var(--cyber1);
    letter-spacing:.5px;
  }
  header img{
    height:56px; width:56px; border-radius:50%; object-fit:cover;
    margin-right:12px; border:2px solid rgba(0,0,0,.2); box-shadow:0 0 10px rgba(0,0,0,.25);
  }

  .card-cyber{
    background: rgba(5,12,28,.55);
    border:1px solid rgba(0,255,240,.25);
    border-radius:18px;
    box-shadow:0 10px 30px rgba(0,0,0,.6), inset 0 0 40px rgba(124,77,255,.08);
    backdrop-filter: blur(4px);
  }
  .card-cyber .card-header{
    background: linear-gradient(135deg, rgba(124,77,255,.35), rgba(0,255,240,.25));
    border-bottom:1px solid rgba(255,255,255,.12);
    color:#eaffff; font-weight:700;
  }
  .form-control, .form-select{
    background: rgba(255,255,255,.03);
    border:1px solid rgba(0,255,240,.25);
    color:#e8faff;
  }
  .form-control:focus, .form-select:focus{
    border-color: var(--cyber1);
    box-shadow: 0 0 0 .2rem rgba(0,255,240,.15);
    color:#fff;
    background: rgba(255,255,255,.05);
  }
  .btn-cyber{
    background: linear-gradient(135deg, var(--cyber2), var(--cyber1));
    color:#02040a; border:none; font-weight:800; letter-spacing:.5px;
    box-shadow: 0 6px 20px rgba(0,255,240,.25);
  }
  .btn-cyber:hover{ filter:brightness(1.08); }

  /* ID card preview */
  .id-card-wrapper{
  perspective: 1000px;
  width: 260px; height: 400px;
}
.id-card-flip{
  width:100%; height:100%;
  position:relative;
  transform-style: preserve-3d;
  transition: transform 0.9s;
}
.id-card-flip.flipped{ transform: rotateY(180deg); }

.id-card-side{
  position:absolute; top:0; left:0;
  width:100%; height:100%;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.5), inset 0 0 20px rgba(0,255,240,.25);
  background: linear-gradient(160deg, rgba(0,255,240,.2), rgba(124,77,255,.3));
  backface-visibility:hidden;
  display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
  padding:14px;
  color:#eaffff; text-align:center;
}

.id-card-side.front{
  background: linear-gradient(160deg, #0f2027, #203a43, #2c5364);
}
.id-card-side.back{
  background:#fff;
  transform: rotateY(180deg);
  display:flex; align-items:center; justify-content:center;
}

.company{
  font-weight:900;
  font-size:1.1rem;
  color:#00fff0;
  text-shadow:0 0 6px #00fff0;
  margin-bottom:12px;
}
.emp-name{
  font-size:1.2rem;
  font-weight:700;
  margin-bottom:12px;
}
.photo{
  width:120px; height:150px;
  border-radius:12px; overflow:hidden;
  border:2px solid #00fff0;
  margin:12px 0;
  box-shadow:0 0 20px rgba(0,255,240,.4);
}
.photo img{ width:100%; height:100%; object-fit:cover; }
.details{
  margin-top:auto;
  font-size:.95rem;
  background:rgba(0,0,0,.3);
  padding:6px 10px;
  border-radius:8px;
  width:100%;
}
.qr-full{
  width: 100%; height:100%;
  display:flex; align-items:center; justify-content:center;
}
.qr-full canvas, .qr-full img{
  width:90% !important; height:90% !important;
  object-fit:contain;
}

   .hint{
    font-size:.8rem; color:#9bdff9;
  }

  /* neon divider */
  .neon-divider{
    height:1px; border:none;
    background: linear-gradient(90deg, transparent, rgba(0,255,240,.6), transparent);
    margin:16px 0;
  }
</style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<header>
  <img src="data/main_logo" alt="Logo">
  New Employee Records ‚Äî Cyber Department
  <!-- üîô Back Button -->
  <button id="backBtn" class="btn btn-sm btn-dark ms-auto" 
          style="position:absolute; left:15px; top:15px; 
                 background:linear-gradient(135deg,#7c4dff,#00fff0);
                 color:#02040a; font-weight:700; border:none; border-radius:6px;
                 padding:6px 14px; box-shadow:0 4px 12px rgba(0,255,240,.3);">
    ‚¨Ö Back
  </button>
</header>


<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card card-cyber">
        <div class="card-header">Register New Employee</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Full Name</label>
              <input id="name" class="form-control" placeholder="Jane Doe">
            </div>
            <div class="col-md-6">
              <label class="form-label">Email</label>
              <input id="email" type="email" class="form-control" placeholder="jane@cyber.gov">
            </div>
            <div class="col-md-6">
              <label class="form-label">Department</label>
              <select id="department" class="form-select" >
                <option value="">-- Select Department --</option>
                <option value="Developer A">Developer A</option>
                <option value="UI">UI</option>
                <option value="UX">UX</option>
                <option value="Java Developer">Java Developer</option>
                <option value="Manager">Manager</option>
                <option value="Editor">Editor</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Role / Title</label>
              <input id="role" class="form-control" placeholder="Analyst">
            </div>
            <div class="col-md-6">
              <label class="form-label">Roll Number (used for QR)</label>
              <input id="roll" class="form-control" placeholder="CYB-2025-001">
              <div class="hint mt-1">The QR code will encode this value.</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Photo</label>
              <input id="photo" type="file" class="form-control" accept="image/*">
            </div>
          </div>

          <hr class="neon-divider">

          <div class="d-flex gap-2">
            <button class="btn btn-cyber" id="previewBtn">Preview ID Card</button>
            <button class="btn btn-outline-info" id="generateQRBtn">Generate QR</button>
            <div id="qrStatus" class="ms-2 align-self-center hint"></div>
          </div>

          <div id="qrHiddenCanvas" class="d-none"></div>
        </div>
        <div class="card-footer text-end bg-transparent border-0">
          <button class="btn btn-cyber" id="saveBtn">Register & Save</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content card-cyber p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title">ID Card Preview</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body d-flex justify-content-center">
        
        <!-- 3D Flip Card -->
        <div class="id-card-wrapper">
          <div class="id-card-flip" id="idCardFlip">
            
            <!-- Front Side -->
            <div class="id-card-side front">
              <div class="company">CYBER DEPARTMENT</div>
              <div class="emp-name" id="prevName">Jane Doe</div>
              <div class="photo">
                <img id="prevPhoto" alt="">
              </div>
              <div class="details">
                <div><strong>Roll:</strong> <span id="prevRoll"></span></div>
                <div><strong>Role:</strong> <span id="prevRole"></span></div>
              </div>
            </div>
            
            <!-- Back Side -->
            <div class="id-card-side back">
              <div id="prevQR" class="qr-full"></div>
            </div>
            
          </div>
        </div>

      </div>
      <div class="modal-footer border-0">
        <button class="btn btn-cyber" id="flipBtn">Flip Card</button>
        <button class="btn btn-cyber" data-bs-dismiss="modal">Looks Good</button>
      </div>
    </div>
  </div>
</div>


<!-- Bootstrap & helpers -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- QRCode.js (client-side QR) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
/* ======== QR helpers ======== */
let cachedQRDataUrl = null;

function makeQR(text, targetEl){
  targetEl.innerHTML = "";
  const qr = new QRCode(targetEl, { text, width: 160, height: 160, correctLevel: QRCode.CorrectLevel.M });
  // Extract a small dataURL for upload/preview cache if needed
  const img = targetEl.querySelector("img") || targetEl.querySelector("canvas");
  if(img){
    // Convert to small dataUrl for preview; for upload we'll send roll string only
    const c = document.createElement("canvas");
    c.width = 160; c.height = 160;
    const ctx = c.getContext("2d");
    if(img.tagName === "IMG"){
      img.onload = () => { ctx.drawImage(img,0,0,160,160); cachedQRDataUrl = c.toDataURL("image/png"); };
    } else {
      ctx.drawImage(img,0,0,160,160);
      cachedQRDataUrl = c.toDataURL("image/png");
    }
  }
}

document.getElementById("generateQRBtn").addEventListener("click", ()=>{
  const roll = document.getElementById("roll").value.trim();
  if(!roll){ document.getElementById("qrStatus").textContent = "Enter Roll Number first."; return; }
  makeQR(roll, document.getElementById("prevQR"));
  document.getElementById("qrStatus").textContent = "QR generated.";
});


/* ======== Preview modal ======== */
const previewModal = new bootstrap.Modal(document.getElementById("previewModal"));

document.getElementById("previewBtn").addEventListener("click", ()=>{
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const dept = document.getElementById("department").value.trim();
  const role = document.getElementById("role").value.trim();
  const roll = document.getElementById("roll").value.trim();
  const file = document.getElementById("photo").files[0];

  if(!name || !email || !dept || !role || !roll){
    alert("Please fill all fields before preview.");
    return;
  }

  document.getElementById("prevName").textContent = name;
  document.getElementById("prevRole").textContent = role;
  document.getElementById("prevRoll").textContent = roll;

  // photo preview
  const prevPhoto = document.getElementById("prevPhoto");
  if(file){
    const reader = new FileReader();
    reader.onload = e => prevPhoto.src = e.target.result;
    reader.readAsDataURL(file);
  } else {
    prevPhoto.src = "";
  }

  // ensure QR shows current roll
  makeQR(roll, document.getElementById("prevQR"));

  previewModal.show(); // ‚úÖ finally open modal
});


/* ======== Save to backend ======== */
document.getElementById("saveBtn").addEventListener("click", async () => { 
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const dept = document.getElementById("department").value.trim();
  const role = document.getElementById("role").value.trim();
  const roll = document.getElementById("roll").value.trim();
  const fileInput = document.getElementById("photo");
  const file = fileInput.files[0];

  if (!name || !email || !dept || !role || !roll) {
    alert("Please fill all fields.");
    return;
  }

  const fd = new FormData();
  fd.append("name", name);
  fd.append("email", email);
  fd.append("department", dept);
  fd.append("role", role);
  fd.append("roll_number", roll);
  if (file) fd.append("photo", file);

  try {
    const res = await fetch("http://127.0.0.1:8000/api/employees", {
      method: "POST",
      body: fd
    });
    const data = await res.json();
    if (data.ok) {
      alert("‚úÖ Employee saved (ID: " + data.employee_id + ")");
      
      // Clear all input fields after successful save
      document.getElementById("name").value = "";
      document.getElementById("email").value = "";
      document.getElementById("department").value = "";
      document.getElementById("role").value = "";
      document.getElementById("roll").value = "";
      fileInput.value = "";  // Clear the file input
    } else {
      alert("‚ùå Save failed: " + (data.message || "unknown error"));
    }
  } catch (err) {
    console.error(err);
    alert("‚ö†Ô∏è Server error ‚Äî is backend running?");
  }
});
</script>

<!-- ======== Three.js Cyber Animation (unique shield) ======== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script>
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bgCanvas'), alpha:false, antialias:true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(devicePixelRatio);
  renderer.setClearColor(0x000000, 1);
  camera.position.z = 6;

  // Wireframe "shield"
  const shieldGeo = new THREE.IcosahedronGeometry(2.2, 2);
  const shieldMat = new THREE.MeshBasicMaterial({ color: 0x00fff0, wireframe:true, transparent:true, opacity:.3 });
  const shield = new THREE.Mesh(shieldGeo, shieldMat);
  scene.add(shield);

  // Inner orb
  const orbGeo = new THREE.SphereGeometry(1.0, 32, 32);
  const orbMat = new THREE.MeshBasicMaterial({ color: 0x7c4dff, wireframe:true, transparent:true, opacity:.25 });
  const orb = new THREE.Mesh(orbGeo, orbMat);
  scene.add(orb);

  // Floating particles ring
  const g = new THREE.BufferGeometry();
  const count = 1800;
  const positions = new Float32Array(count*3);
  for(let i=0;i<count;i++){
    const r = 5 + Math.random()*1.5;
    const a = Math.random()*Math.PI*2;
    const y = (Math.random()-.5)*1.2;
    positions[i*3+0] = Math.cos(a)*r;
    positions[i*3+1] = y;
    positions[i*3+2] = Math.sin(a)*r;
  }
  g.setAttribute("position", new THREE.BufferAttribute(positions,3));
  const points = new THREE.Points(g, new THREE.PointsMaterial({ color:0x7c4dff, size:0.03 }));
  scene.add(points);

  function animate(){
    requestAnimationFrame(animate);
    shield.rotation.x += 0.0025;
    shield.rotation.y += 0.0035;
    orb.rotation.y -= 0.003;
    points.rotation.y += 0.0009;
    renderer.render(scene, camera);
  }
  animate();

  addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });


<!--card filp-->

  const flipBtn = document.getElementById("flipBtn");
const idCardFlip = document.getElementById("idCardFlip");
flipBtn.addEventListener("click", ()=>{
  idCardFlip.classList.toggle("flipped");
});

</script>

<script>
  // Back button redirect
  document.getElementById("backBtn").addEventListener("click", ()=>{
    window.location.href = "homepage.html";  // ‚úÖ go to homepage
  });
</script>

</body>
</html>
